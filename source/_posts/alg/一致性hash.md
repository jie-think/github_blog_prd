# 一致性 hash

### 一致性 hash 解决的问题

在使用n台缓存服务器时，一种常用的负载均衡方式是，对资源o的请求使用 ${\displaystyle {\mbox{hash}}(o)=o\mod n}$ 来映射到某一台缓存服务器。当增加或减少一台缓存服务器时这种方式可能会改变所有资源对应的hash值，也就是所有的缓存都失效了，这会使得缓存服务器大量集中地向原始内容服务器更新缓存。因此需要一致哈希算法来避免这样的问题。 一致哈希尽可能使同一个资源映射到同一台缓存服务器。这种方式要求增加一台缓存服务器时，新的服务器尽量分担存储其他所有服务器的缓存资源。减少一台缓存服务器时，其他所有服务器也可以尽量分担存储它的缓存资源。 一致哈希算法的主要思想是将每个缓存服务器与一个或多个哈希值域区间关联起来，其中区间边界通过计算缓存服务器对应的哈希值来决定。（定义区间的哈希函数不一定和计算缓存服务器哈希值的函数相同，但是两个函数的返回值的范围需要匹配。）如果一个缓存服务器被移除，则它所对应的区间会被并入到邻近的区间，其他的缓存服务器不需要任何改变。

总结:

解决的是分布式缓存,节点失效导致数据不可用和数据倾斜的问题.



原理:

![a0e32fde-3a5f-11e6-969d-085f64220e63](assets/a0e32fde-3a5f-11e6-969d-085f64220e63.png)

图片出自: [一致性哈希算法的理解与实践](https://yikun.github.io/2016/06/09/一致性哈希算法的理解与实践/)



参考:

[一致性哈希算法的理解与实践](https://yikun.github.io/2016/06/09/一致性哈希算法的理解与实践/)

[wiki: 一致性 hash](https://zh.wikipedia.org/zh-hans/一致哈希)

